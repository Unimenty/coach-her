<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Victory Coach</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        .chat-bubble {
            max-width: 75%;
            word-wrap: break-word;
        }
        .user-bubble {
            background: linear-gradient(to right, #7e22ce, #9333ea);
        }
        .bot-bubble {
            background: #1e1b4b;
            color: #e9d5ff;
        }
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6d28d9 0%, #4c1d95 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: bold;
        }
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            color: #a78bfa;
        }
        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: #a78bfa;
            border-radius: 50%;
            animation: typing-blink 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing-blink {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        @media (max-width: 1024px) {
            .chat-panel {
                max-width: 90%;
                height: 75vh;
            }
        }
        @media (max-width: 640px) {
            .chat-panel {
                max-width: 100%;
                height: 70vh;
                margin: 0;
                padding: 2px;
            }
            #userInput {
                padding: 2px;
            }
            #sendButton {
                padding: 2px;
            }
        }
    </style>
</head>
<body class="bg-[#0f172a] flex items-center justify-center min-h-screen p-4 text-white">
    <div class="bg-[#1e1b4b] w-full max-w-lg h-[85vh] rounded-2xl shadow-xl flex flex-col chat-panel border border-[#6d28d9]">
        <!-- Header -->
        <div class="p-4 border-b border-[#6d28d9] bg-gradient-to-r from-[#4c1d95] to-[#2e1065] rounded-t-2xl flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold text-violet-100">Victory Coach</h1>
                <p class="text-sm text-violet-200">Turn Plans into Action—Win Every Day.</p>
            </div>
            <button onclick="clearHistory()" class="ml-2 p-2 rounded border text-xs text-violet-100 border-violet-700 hover:bg-violet-700 transition-all">Clear History</button>
        </div>
        <!-- Chat display area -->
        <div id="chatWindow" class="flex-1 p-6 overflow-y-auto bg-gradient-to-b from-[#1e1b4b] to-[#0f172a]">
            <div id="messages" class="space-y-4">
                <!-- Messages will be appended here -->
            </div>
            <div id="loadingIndicator" class="hidden text-center my-4">
                <svg class="animate-spin h-5 w-5 mx-auto text-violet-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <div id="typingIndicator" class="hidden typing-indicator">
                <span>Victory Coach is typing</span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
                <span class="typing-dot"></span>
            </div>
        </div>
        <!-- Input area -->
        <div class="p-4 border-t border-[#6d28d9] bg-gradient-to-r from-[#1e1b4b] to-[#2e1065] rounded-b-2xl">
            <div class="flex space-x-3">
                <input
                    id="userInput"
                    type="text"
                    placeholder="Type your message..."
                    class="flex-1 p-3 border border-violet-700 rounded-full focus:outline-none focus:ring-2 focus:ring-violet-500 bg-[#1e1b4b] text-violet-100 placeholder-violet-400"
                >
                <button
                    id="sendButton"
                    class="bg-gradient-to-r from-[#7e22ce] to-[#6d28d9] text-white p-3 rounded-full flex items-center justify-center shadow-lg transition-all duration-200 hover:from-[#6d28d9] hover:to-[#5b21b6] hover:shadow-xl hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-violet-500 focus:ring-offset-2"
                    aria-label="Send message"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="#ffffff">
                        <path d="M2 21l21-9L2 3v7l15 2-15 2v7z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        const chatWindow = document.getElementById('chatWindow');
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const typingIndicator = document.getElementById('typingIndicator');

        // Function to add a message to the chat
        function addMessage(content, isUser = false, skipSave = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = isUser
                ? 'flex justify-end items-end space-x-2'
                : 'flex justify-start items-end space-x-2';
            // Parse Markdown for bot messages, use plain text for user messages
            const displayContent = isUser ? content : marked.parse(content);
            messageDiv.innerHTML = `
                ${isUser ? '' : '<div class="avatar">AI</div>'}
                <div class="chat-bubble ${isUser ? 'user-bubble text-white' : 'bot-bubble'} p-3 rounded-2xl">
                    ${displayContent}
                </div>
                ${isUser ? '<div class="avatar">U</div>' : ''}
            `;
            messagesContainer.appendChild(messageDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;

            // Save to localStorage unless loading from history
            if (!skipSave) {
                saveMessageToHistory({ content, isUser });
            }
        }

        // LocalStorage helpers
        function saveMessageToHistory(message) {
            let history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            history.push(message);
            localStorage.setItem('chatHistory', JSON.stringify(history));
        }

        function loadHistory() {
            let history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            if (history.length > 0) {
                messagesContainer.innerHTML = '';
                history.forEach(msg => addMessage(msg.content, msg.isUser, true));
            }
        }

        function clearHistory() {
            localStorage.removeItem('chatHistory');
            messagesContainer.innerHTML = '';
            // Show welcome message again
            addMessage('Listen up! I’m here to push you to your limits. Pick one big goal you’ve been avoiding—something that’s been sitting on your mind like a weight you can’t shake. Tell me what it is, and be real about it. I’ll break it down into actionable steps you can start today. No excuses—prove you’re serious, or I’ll call you out and set a deadline to get moving. What’s your goal, and are you ready to commit?');
        }

        // Function to call the Gemini API with Pathfinder Pro persona
        async function callLLMApi(message) {
            try {
                typingIndicator.classList.remove('hidden'); // Show typing indicator
                const response = await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=AIzaSyD5IbhMCu9RBDH4h9stLg6kKbz8m9q5zB4", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "contents": [
                            {
                                "role": "model",
                                "parts": [
                                    {
                                        "text": "You are The Ghanaian Pathfinder - a no-nonsense hyper-driven success coach blending market-hustler urgency, military precision, and elder wisdom. Rules: 1) Demand immediate action ('Send that email NOW'), 2) Call out excuses ('Your \"busy\" means 4hr TikTok daily'), 3) Auto-generate solutions when stuck. Tone: Direct ('This goal is colder than last night's waakye'), Strategic ('Attack this like Accra traffic - swerve obstacles fast'), Wise ('Elders say \"The crab walks slowly but reaches the sea\" - START WALKING'). Protocol: Verify real commitment ('Serious or just thinking?'), Assign instant tasks ('Call the client in 5 minutes'), Enforce accountability ('No proof by sunset? Prepare for mother-level reminders'). First words: 'Stop explaining! From Takoradi to Tamale, winners act. Name ONE avoided goal - we break it into TODAY'S steps. SPEAK!"
                                    }
                                ]
                            },
                            {
                                "role": "user",
                                "parts": [
                                    {
                                        "text": message
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    throw new Error('API request failed');
                }

                const data = await response.json();
                // Extract the response content from Gemini API structure
                return data.candidates[0].content.parts[0].text || 'Sorry, I could not process your request.';
            } catch (error) {
                console.error('Error:', error);
                return 'Error connecting to the AI service.';
            } finally {
                loadingIndicator.classList.add('hidden');
                typingIndicator.classList.add('hidden'); // Hide typing indicator
            }
        }

        // Handle send button click
        sendButton.addEventListener('click', async () => {
            const message = userInput.value.trim();
            if (message) {
                // Add user message to chat
                addMessage(message, true);
                userInput.value = '';

                // Call LLM API and display response
                const response = await callLLMApi(message);
                addMessage(response);
            }
        });

        // Allow sending message with Enter key
        userInput.addEventListener('keypress', async (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });

        // Load chat history if available
        loadHistory();

        // Only show welcome message if no history
        if (!localStorage.getItem('chatHistory') || JSON.parse(localStorage.getItem('chatHistory')).length === 0) {
            addMessage('Listen up! I’m here to push you to your limits. Pick one big goal you’ve been avoiding—something that’s been sitting on your mind like a weight you can’t shake. Tell me what it is, and be real about it. I’ll break it down into actionable steps you can start today. No excuses—prove you’re serious, or I’ll call you out and set a deadline to get moving. What’s your goal, and are you ready to commit?');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962d570f79181dd8',t:'MTc1MzEyODYwOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962d5c1a3f2b67ea',t:'MTc1MzEyODgxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962d65a51c68b883',t:'MTc1MzEyOTIwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>